<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>0:00</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer>
    const dailyHours = { 0: 1, 1: 2, 2: 2, 3: 2, 4: 2, 5: 1, 6: 1 };
    const getTodayKey = () => new Date().toLocaleDateString("en-CA");

    let db;

    const openDB = () => {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open("debtTrackerDB", 1);
        request.onupgradeneeded = event => {
          db = event.target.result;
          db.createObjectStore("state", { keyPath: "key" });
          db.createObjectStore("logs", { keyPath: "date" });
        };
        request.onsuccess = event => {
          db = event.target.result;
          resolve(db);
        };
        request.onerror = () => reject("IndexedDB failed to open.");
      });
    };

    const saveToDB = (storeName, data) => {
      return new Promise(resolve => {
        const tx = db.transaction(storeName, "readwrite");
        const store = tx.objectStore(storeName);
        store.put(data);
        tx.oncomplete = resolve;
      });
    };

    const getFromDB = (storeName, key) => {
      return new Promise(resolve => {
        const tx = db.transaction(storeName, "readonly");
        const store = tx.objectStore(storeName);
        const request = store.get(key);
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => resolve(null);
      });
    };

    const loadData = async () => {
      const today = getTodayKey();
      const state = await getFromDB("state", "mainState") || {
        debtHours: 0,
        debtMinutes: 0,
        lastUpdate: ""
      };

      let { debtHours: hours, debtMinutes: mins, lastUpdate } = state;

      if (lastUpdate !== today) {
        const todayDay = new Date().getDay();
        hours += dailyHours[todayDay];

        await saveToDB("state", {
          key: "mainState",
          debtHours: hours,
          debtMinutes: mins,
          lastUpdate: today
        });
      }

      return { hours, mins };
    };

    const saveState = async (hours, mins) => {
      await saveToDB("state", {
        key: "mainState",
        debtHours: hours,
        debtMinutes: mins,
        lastUpdate: getTodayKey()
      });

      document.getElementById("debtHoursValue").innerText = `${hours} hrs ${mins} mins`;
    };

    const updateCountdown = () => {
      const now = new Date();
      const tomorrow = new Date();
      tomorrow.setHours(24, 0, 0, 0);
      const diff = tomorrow - now;

      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);

      document.getElementById("countdown").innerText = `Next update in: ${hours}h ${minutes}m ${seconds}s`;
    };

    let stopwatchInterval;
    let stopwatchStartTime = null;
    let elapsedTime = 0;
    let running = false;

    const updateStopwatch = () => {
      let displayTime = elapsedTime;
      if (running && stopwatchStartTime !== null) {
        displayTime += Date.now() - stopwatchStartTime;
      }

      const totalSeconds = Math.floor(displayTime / 1000);
      const mins = Math.floor(totalSeconds / 60) % 60;
      const secs = totalSeconds % 60;
      const millis = Math.floor((displayTime % 1000) / 10);
      const hrs = Math.floor(totalSeconds / 3600);

      document.getElementById("stopwatchTime").innerText = `${hrs > 0 ? hrs + ":" : ""}${mins}:${secs.toString().padStart(2, "0")}.${millis.toString().padStart(2, "0")}`;
      document.title = `${hrs > 0 ? hrs + ":" : ""}${mins}:${secs.toString().padStart(2, "0")}`;

      const spinner = document.getElementById("spinnerCircle");
      const circumference = 2 * Math.PI * 45;
      const progress = (displayTime / 1000) % 60 / 60;
      spinner.style.strokeDashoffset = `${circumference * (1 - progress)}`;
    };

    const toggleStopwatch = () => {
      if (!running) {
        stopwatchStartTime = Date.now();
        stopwatchInterval = setInterval(updateStopwatch, 50);
        running = true;
      } else {
        elapsedTime += Date.now() - stopwatchStartTime;
        stopwatchStartTime = null;
        clearInterval(stopwatchInterval);
        running = false;
      }
      updateStopwatch();
    };

    window.onload = async () => {
      if (navigator.storage && navigator.storage.persist) {
        await navigator.storage.persist();
      }

      await openDB();
      document.getElementById("mainContainer").classList.remove("opacity-0", "translate-y-5");

      let { hours, mins } = await loadData();
      document.getElementById("debtHoursValue").innerText = `${hours} hrs ${mins} mins`;

      document.getElementById("editBtn").addEventListener("click", async () => {
        const newHours = prompt("Enter new debt hours:", hours);
        const newMins = prompt("Enter new debt minutes:", mins);
        if (newHours !== null && !isNaN(parseFloat(newHours)) && newMins !== null && !isNaN(parseInt(newMins))) {
          hours = parseFloat(newHours);
          mins = parseInt(newMins);
          await saveState(hours, mins);
        }
      });

      document.getElementById("doneBtn").addEventListener("click", async () => {
        const doneHours = parseFloat(document.getElementById("doneHours").value || "0");
        const doneMins = parseInt(document.getElementById("doneMinutes").value || "0");

        let totalMins = hours * 60 + mins - (doneHours * 60 + doneMins);
        totalMins = Math.max(0, totalMins);

        hours = Math.floor(totalMins / 60);
        mins = totalMins % 60;
        await saveState(hours, mins);

        const today = getTodayKey();
        await saveToDB("logs", {
          date: today,
          debt: `${hours} hrs ${mins} mins`,
          done: `${doneHours} hrs ${doneMins} mins`
        });
      });

      document.getElementById("playPauseBtn").addEventListener("click", toggleStopwatch);
      document.getElementById("resetBtn").addEventListener("click", () => {
        stopwatchStartTime = null;
        elapsedTime = 0;
        running = false;
        clearInterval(stopwatchInterval);
        updateStopwatch();
      });

      updateCountdown();
      setInterval(updateCountdown, 1000);
    };
  </script>
  <style>
    #spinnerCircle {
      transition: stroke-dashoffset 0.05s linear;
      transform: rotate(-90deg);
      transform-origin: center;
    }
  </style>
</head>
<!-- Only changed: layout classes are responsive, elements shrink nicely on mobile -->
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6">
  <div id="mainContainer" class="flex flex-col lg:flex-row gap-6 lg:gap-8 opacity-0 translate-y-5 transition-all duration-700 w-full max-w-6xl">
    <!-- Debt Hours Panel -->
    <div class="bg-white shadow-lg rounded-2xl p-6 sm:p-8 w-full lg:w-1/2 text-center relative transform transition hover:scale-105">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4 sm:mb-6">Debt Hours</h1>
      <div class="text-4xl sm:text-5xl font-semibold text-blue-600 mb-6 sm:mb-8" id="debtHoursValue">0 hrs 0 mins</div>
      <button id="editBtn" class="bg-blue-500 hover:bg-blue-600 active:scale-95 text-white font-bold py-3 px-5 rounded-xl text-base sm:text-lg transition-all w-full sm:w-auto">Edit Manually</button>
      <p class="mt-4 sm:mt-6 text-gray-400 text-sm sm:text-base">This value updates automatically daily</p>

      <div class="mt-8 sm:mt-10">
        <h2 class="text-lg sm:text-xl font-semibold text-gray-700 mb-2 sm:mb-3">Work done today:</h2>
        <div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 mb-4">
          <input id="doneHours" type="number" min="0" placeholder="Hours" class="w-full sm:w-24 p-3 border rounded-xl text-base sm:text-lg" />
          <input id="doneMinutes" type="number" min="0" placeholder="Minutes" class="w-full sm:w-24 p-3 border rounded-xl text-base sm:text-lg" />
        </div>
        <button id="doneBtn" class="bg-blue-500 hover:bg-blue-600 active:scale-95 text-white font-bold py-3 px-5 rounded-xl text-base sm:text-lg transition-all w-full sm:w-auto">Done</button>
      </div>

      <div id="countdown" class="mt-5 text-gray-400 text-sm sm:text-base"></div>
    </div>

    <!-- Stopwatch Panel -->
    <div class="bg-white shadow-lg rounded-2xl p-6 sm:p-8 w-full lg:w-1/2 text-center relative flex flex-col items-center transform transition hover:scale-105">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4 sm:mb-6">Stopwatch</h1>
      <div id="spinnerContainer" class="relative w-40 sm:w-48 h-40 sm:h-48 mb-5 sm:mb-6">
        <svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" stroke="#e5e7eb" stroke-width="10" fill="none" />
          <circle cx="50" cy="50" r="45" stroke="#3b82f6" stroke-width="10" fill="none" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="283" id="spinnerCircle" />
        </svg>
        <div class="absolute top-0 left-0 w-full h-full flex items-center justify-center">
          <div id="stopwatchTime" class="text-2xl sm:text-3xl font-bold text-blue-600">0:00.00</div>
        </div>
      </div>
      <div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 mt-3 sm:mt-4 w-full sm:w-auto">
        <button id="playPauseBtn" class="bg-blue-500 hover:bg-blue-600 active:scale-95 text-white font-bold py-3 px-5 rounded-xl text-base sm:text-lg transition-all w-full sm:w-auto">Play/Pause</button>
        <button id="resetBtn" class="bg-blue-500 hover:bg-blue-600 active:scale-95 text-white font-bold py-3 px-5 rounded-xl text-base sm:text-lg transition-all w-full sm:w-auto">Reset</button>
      </div>
    </div>
  </div>
</body>

</html>
